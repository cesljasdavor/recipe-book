import {Injectable, EventEmitter, Output} from '@angular/core';
import {Recipe} from "./recipe";
import {Ingredient} from "../shared/ingredient";
import {Headers, Http, Response} from "@angular/http";
import 'rxjs/Rx';


@Injectable()
export class RecipeService {
  //tvoja bivsa izmjena
  //@Output() recipeSelected = new EventEmitter<Recipe>();

  recipesChanged = new EventEmitter<Recipe[]>();
  recipes: Recipe[] = [
    new Recipe("Čevapčići", "Ispečeš čevape i staviš luka i somun","https://encrypted-tbn1.gstatic.com/images?q=tbn:ANd9GcQ0jhKWi-PWm9qaFqShfY_K-GTpDKfpHs94nsnSY2RNN6JfrB8-", [
      new Ingredient("Luk glavica", 2),
      new Ingredient("Somun", 1),
      new Ingredient("Čevapčići", 10)
    ]),
    new Recipe("Pita","Saviješ pitu","data:image/jpeg;base64,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",[])
  ];
  constructor(private http: Http) { }

  getRecipes() {
    return this.recipes;
  }

  getRecipe(index: number) {
    return this.recipes[index];
  }

  deleteRecipe(recipe: Recipe) {
    //doslovno kao remove u javi ali se recimo te metode nitko nije sjetio...
    this.recipes.splice(this.recipes.indexOf(recipe), 1);
  }

  addRecipe(newRecipe: Recipe) {
    this.recipes.push(newRecipe);
  }

  editRecipe(oldRecipe: Recipe, newRecipe: Recipe) {
    this.recipes[this.recipes.indexOf(oldRecipe)] = newRecipe;
  }

  //http
  storeData() {
    const body = JSON.stringify(this.recipes);
    const header = new Headers({
      'Content-Type': "application/json"
    });

    return this.http.put("https://recipebook-4b40f.firebaseio.com/recipes.json", body, {
              headers: header
            });
  }

  fetchData() {
    //isti je url jer je ugnjezdio polje
    this.http.get("https://recipebook-4b40f.firebaseio.com/recipes.json").map(
      (response: Response) => response.json()
    ).subscribe(
      (data: Recipe[]) => {
        this.recipes = data;
        this.recipesChanged.emit(this.recipes);
      },
      //error => console.log(error)

    );
    //console.log(this.recipes);
  }
}
